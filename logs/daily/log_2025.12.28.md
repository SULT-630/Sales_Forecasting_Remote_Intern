# Daily Log — 2025-12-24

## Objective
- Run the minimal model without rolling predict to test all the features and hyperparameters

## Works done


## Key Findings
- base model(is_discount, discount_ratio):
    - overall MAPE: 12.0555
    - 虽然整体MAPE不高，但是震动的频率的幅度都很大，尖峰经常出现，尤其是在2029.1.13的那一周，MAPE达到了19%左右
- year: 
    - overall MAPE：12.7993
    - 整体MAPE变高了，原本的在2029.1.13的尖峰更加糟糕
    - 在2029-01-13，sku_id = 398721 有MAPE = 111.003138非常糟糕
    - 不应该留下
- month: 
    - overall MAPE: 12.0403
    - 整体的MAPE变小了，而且模型在大部分时间的MAPE都有所改善，除了2029.1.13这个异常周，MAPE被放大了
    - 最高MAPE出现在2027-02-12  673209     131.660583
    - 考虑进入受控区，不能直接进入base但是在未来与周期性特征组合之后可能会变好
- quarter: 
    - oveall MAPE: 12.0027
    - 整体的MAPE变小了，模型在大部分时间的MAPE都有所改善，除了2029.1.13以及2027.2.12的两个尖峰处，MAPE被放大了
    - 最高MAPE出现在2029-01-13  398721     120.101628
    - 考虑进入受控区，不能直接进入base但是在未来与周期性特征组合之后可能会变好
- year + month + quarter: 
    - overall MAPE: 12.4587
    - 整体MAPE变大了，而原本的异常尖峰明显更糟糕了，所以不应该留下
    - 在2029.1.13 sku_id = 398721时，有MAPE = 129.10非常糟糕
- week_of_year: 
    - overall MAPE: 12.0433
    - 整体的MAPE略微变小，整体的波动变得稍微平滑了一点，但依旧对于尖峰无能为力
    - 最大MAPE出现在2027-02-12  673209     125.556425
    - 考虑保留
- month + week_of_year:
    - overall MAPE: 12.0267
    - 时间序列图几乎是一样的，但在尖峰处基本上都更差了，进入受控区
- quarter + week_of_year:
    - overall MAPE: 12.0391
    - 时间序列图几乎是一样的，但在尖峰处基本上都更差了，进入受控区
- is_month_start: 
- is_month_end: 
    - overall MAPE: 12.0525
    - 整体几乎一致，总MAPE略微变小了，可以保留
- is_quarter_start:
- is_quarter_end: 
    - overall MAPE: 12.0525
    - 整体几乎一致，总MAPE略微变小了，可以保留
- sin_week_of_year: 
- cos_week_of_year: *champion*
    - overall MAPE: 12.0105
    - 最大MAPE出现在2027-02-12  673209     129.275430
    - 主体区间下移了，整体MAPE也变低了，虽然对于2029的尖峰依旧无能为了，但是起伏更加连续了，说明模型开始意识到周期问题
- sin_cos_week_of_year + week_of_year
    - overall MAPE: 12.0637
    - 波动上的改变主要有sin cos主导，而且整体MAPE变高了，所以不需要两个都使用
- champion + sin_month: 
- champion + cos_month: 
    - overall MAPE 12.0655
    - 波动上的改变主要由sin cos主导，而且整体MAPE变高了，所以不保留
- champion + week from start:
    - overall MAPE: 12.8558
    - 没有解决任何问题，并且放大了所有MAPE和尖峰
- champion + sin cos week from start:
    - overall MAPE: 11.8076
    - 2029的异常尖峰被压低了，而且整体的波动变得更小，应该保留
- champion = sin cos week of year + sin cos week from start

- gap_since_lag_record(1,2,4): 
    - overall MAPE: 11.8259
    - 最大尖峰略微降低，但2027年的第二尖峰略微增高，整体波动更平滑，整体MAPE下降了，考虑保留
- champion = sin cos week of year + sin cos week from start + gap

- lag_features(1,2,4): 
    - overall MAPE: 11.6155
    - 又改善了整体MAPE，而且最高的尖峰也改善了，整体波动更平滑，必须保留
    - champion = sin cos week of year + sin cos week from start + gap + lag

- rolling_mean(1,2,4): 
- rolling std(1,2,4): 
    - overall MAPE: 11.5735
    - 2029处最高尖峰略微增加，其余部分整体变好，说明rolling对于稳态sku有帮助，需要配合节假日标注等再实验
- EWM(1,2,4):
    - overall MAPE: 11.5241
    - 比rolling更平滑，因为是相同作用，所以可以考虑只保留ewm，对于尖峰无能为力，但其余均变好
- champion = champion = sin cos week of year + sin cos week from start + gap + lag + ewm
- target_changing_rate:
    - overall MAPE: 11.4928
    - 2029的尖峰处明显压小了，几次波动的范围更加相近，但影响有限
    - 可以保留
- champion = champion = sin cos week of year + sin cos week from start + gap + lag + ewm + changing rate

- target_changing_rate_per_gap: 
    - overall MAPE: 11.5552
    - 虽然整体MAPE上升了，但是图中的尖峰基本上都被压低了，说明结构得到了改善，所以应该保留
- champion = champion = sin cos week of year + sin cos week from start + gap + lag + ewm + changing rate + changin rate per gap

- champion中无changing rate：
    - overall MAPE: 11.4541
    - 几乎和原来没有特别大的区别，所以可以说不需要保留changing rate，只需要per gap就可以了
- champion = champion = sin cos week of year + sin cos week from start + gap + lag + ewm + changin rate per gap
## Issues Encountered
- 最大MAPE经常出现在 
    - 2027-02-12  673209
    - 2029-01-13  398721
    - 2026-06-12  673209
    - 2029-01-13  245387
    - 2027-03-12  219844
    - 2028-02-11  300291
    - 2029-01-13  245338
- 是不是2029.1.13的时候数据量特别小？
## How Issues Were Resolved

## Problems

## Next Steps
2025.9.12 - 2031.10.11